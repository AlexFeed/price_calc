ДЕРЕВО ПРОЕКТА
.

├── .venv/  
│   (виртуальное окружение Python для локальной разработки; содержит установленный интерпретатор и пакеты).
│   

├── calculator/  (Django-приложение: модели, представления, шаблоны и статические файлы)
│   ├── __init__.py
│   │   (делает папку `calculator` пакетом Python — нужно для импорта внутри проекта).
│   ├── admin.py
│   │   (регистрация моделей в Django Admin — сюда добавлены настройки отображения `Rate` в админке).
│   ├── apps.py
│   │   (конфигурация приложения: имя приложения и точка для сигналов/инициализации при старте Django).
│   ├── models.py
│   │   (модель `Rate` — основная сущность: `origin_city`, `destination_city`, `container_type`, `transport_type`,
│    `email`, `rate`, `input_date`, `processing_status`, `last_edited_by`, `created_at`).
│   │   Описание полей и выборов `processing_status` — используется в логике уведомлений и управлении.
│   ├── urls.py
│   │   (внутренние маршруты приложения: корень (`''`) ведёт на `index`, `/manage/` — интерфейс управления,
│   │    API-маршруты: `/manage/api/records/`, `/manage/api/records/<id>/`, `/manage/api/notifications/`,
│   │    `/calculator/api/calc/`, `/api/receive_rate/` и др.).
│   ├── views.py
│   │   (обработчики HTTP-запросов — основная серверная логика:
│   │    - `index` — рендер стартовой страницы калькулятора и форм, 
│   │    - `calc_api` — возвращает JSON с расчётной статистикой и списком ставок,
│   │    - `interface_database` — рендерит панель управления письмами,
│   │    - `records_api` — пагинация записей для UI,
│   │    - `record_detail_api` — новый endpoint для получения одной записи по id,
│   │    - `notifications_api` — набор записей с `processing_status='incorrect'` для уведомлений,
│   │    - `manage_users_api`, `manage_login_api`, `manage_logout_api`, `whoami` — пользовательская аутентификация через сессии,
│   │    - `receive_rate` — webhook для внешнего сервиса (IMAP-парсер) — принимает JSON и создаёт `Rate`).
│   ├── sample_rates.json
│   │   (пример набора ставок в формате JSON — используется командой управления для заполнения БД в dev).
│   ├── management/
│   │   └── commands/
│   │       └── load_sample_rates.py
│   │           (пользовательская Django-команда `manage.py load_sample_rates` — импортирует `sample_rates.json` в базу).
│   ├── migrations/
│   │   ├── __init__.py
│   │   ├── 0001_initial.py
│   │   │   (миграция создания модели `Rate` — первоначальная схема таблицы).
│   │   └── 0002_rate_last_edited_by_rate_processing_status.py
│   │       (миграция, добавившая поля `last_edited_by` и `processing_status` к модели `Rate`).
│   └── static/
│       └── calculator/
│           └── atk_styles.css
│               (централизованный CSS файл, извлечённый из `ATK.html`, содержит стили для калькулятора, шапки и UI).

├── templates/  (глобальная директория шаблонов Django)
│   └── calculator/
│       ├── index.html
│       │   (стартовая страница — пользовательский калькулятор. Форма отправляется через AJAX на `/calculator/api/calc/`,
│       │    результаты рендерятся внутри контейнера `#resultContainer`. В шапке расположен переключатель "Управление письмами"
│       │    и кнопка уведомлений.)
│       ├── interface_database.html
│       │   (панель управления письмами: логин/регистрация, таблица писем с серверной пагинацией, фильтр по статусу,
│       │    модальное окно редактирования. Клиент взаимодействует с API `/manage/api/*` и использует CSRF и session cookies.)
│       ├── result.html
│       │   (устаревшая/резервная страница результатов; раньше использовалась как отдельный view, сейчас результаты
│       │    показываются inline в `index.html`, но файл оставлен для совместимости или резервного рендера.)
│       └── ATK.html
│           (оригинальная верстка/шаблон откуда были взяты стили — содержимое служит как эталон дизайна).

├── pricecalc/  (проект Django: настройки и точки входа)
│   ├── settings.py
│   │   (главные настройки проекта: `INSTALLED_APPS` включает `calculator`, настройки базы данных,
│   │    статических файлов, `EMAIL_API_KEY` для простого ограничения webhook, конфигурация middleware и т.д.)
│   ├── urls.py
│   │   (корневой `urlpatterns` — включает маршруты приложения `calculator` и `admin`.)
│   └── wsgi.py
│       (точка входа WSGI для деплоя/серверов; при локальном запуске `manage.py runserver` обычно не используется напрямую).

├── shared/
│   └── email_extractor.py
│       (модуль с функциями/шаблонами для извлечения данных из писем — парсер, который использует `email-processor` при
│        обработке входящих писем и формирует JSON для отправки в `receive_rate`).

├── email-processor/  (отдельный сервис для опроса IMAP и отправки распарсенных данных в Django)
│   ├── README.md
│   │   (инструкции по развёртыванию/настройке poller'а: параметры IMAP, где положить API-ключ и как запускать.)
│   ├── requirements.txt
│   │   (зависиимости для этого сервиса — например `imapclient`, `requests` и т.д.)
│   ├── main.py
│   │   (основной исполняемый скрипт: подключается к почтовому ящику, ищет новые письма, передаёт их в `email_handler`).
│   └── email_handler.py
│       (механика парсинга каждого письма: вызывает `shared/email_extractor.py`, собирает JSON и POST'ит на
│        `https://.../api/receive_rate/` с заголовком `X-API-KEY`.)

├── tools/  (утилиты и вспомогательные скрипты для разработки и тестирования)
│   ├── check_last_rate.py
│   │   (утилита, которая выводит последнюю (по `input_date`) запись из БД — удобно для быстрой проверки.)
│   ├── clear_rates_standalone.py
│   │   (локальный скрипт для очистки таблицы ставок; может использоваться вне Django-менеджера).
│   ├── count_rates.py
│   │   (скрипт подсчёта записей по разным статусам — использовался для быстрой валидации тестовых данных).
│   ├── create_dev_superuser.py
│   │   (создаёт суперпользователя в dev БД при необходимости — упрощает доступ в админку).
│   ├── create_test_rate.py
│   │   (создаёт одну тестовую запись `Rate` через ORM для ручного тестирования).
│   ├── create_test_rate_standalone.py
│   │   (аналогичен, но может работать без полной конфигурации проекта).
│   ├── dump_last_rate_utf8_standalone.py
│   │   (утилита для дампа последней записи в UTF-8 — полезно при проблемах с кодировкой в SQLite).
│   ├── generate_50_rates.py
│   │   (генератор тестовых данных: создаёт 50 записей `Rate`, случайно заполняя `processing_status` для проверки уведомлений).
│   ├── inspect_rate.py
│   │   (инструмент для вывода подробной информации о конкретной записи по id).
│   ├── sqlite_encoding.py
│   │   (утилита/заметки по вопросам кодировки SQLite и как правильно экспортировать/импортировать данные).
│   ├── sql_query.py
│   │   (скрипт для выполнения произвольных SQL-запросов к локальной базе — осторожно использовать в dev).
│   ├── test_api_post.py
│   │   (скрипт/юнит-ориентированный тест для проверки POST в `receive_rate` — полезно для интеграционных тестов).
│   ├── test_manage_api.py
│   │   (тесты для `/manage/api/*` эндпойнтов).
│   ├── test_result_view.py
│   │   (тесты, которые проверяют корректность `calc_api`/рендера результатов).
│   └── test_session_flow.py
│       (проверяет flow логин/регистрация/whoami/logout для клиентской части управления).

├── manage.py
│   (стандартный Django CLI-скрипт: `python manage.py runserver`, `migrate`, `createsuperuser` и т.д.)

├── db.sqlite3  
│   (локальная SQLite база данных — содержит все модели и тестовые записи; не храните чувствительные данные в dev файлах).

├── README.md
│   (внешняя документация проекта с кратким описанием архитектуры, инструкциями по запуску в dev-mode и заметками)

└── requirements.txt
	(список зависимостей Python для виртуального окружения проекта — `pip install -r requirements.txt`).


Пояснения по типичным изменениям и дальнейшим шагам
- Добавление/изменение модели `Rate`: правьте `calculator/models.py` и создавайте миграции `manage.py makemigrations` + `migrate`.
- Шаблоны интерфейсов: правьте файлы в `templates/calculator/` (если меняете JS — проверьте CSRF и `credentials: 'same-origin'`).
- Добавление полей и API: обновите `calculator/views.py` и `calculator/urls.py` одновременно.
- Email ingestion: внешний `email-processor` отправляет POST на `/api/receive_rate/` с `X-API-KEY`; проверьте `pricecalc/settings.py`.

Если нужно — могу дополнительно сгенерировать `README_DEV.md` с командами запуска, примерами запросов к API и отладочными командами для Windows (PowerShell).
